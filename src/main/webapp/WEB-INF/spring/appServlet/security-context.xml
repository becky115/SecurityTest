<?xml version="1.0" encoding="UTF-8"?>
<beans:beans xmlns="http://www.springframework.org/schema/security"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
	http://www.springframework.org/schema/beans/spring-beans.xsd
	http://www.springframework.org/schema/security 
	http://www.springframework.org/schema/security/spring-security.xsd 
	http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd
	">
	
	
			<context:component-scan base-package="com.eunji" />
	<context:annotation-config />
	
		<http pattern="/resources/**" security="none"/>
		<!-- <http pattern="/login" security="none"></http> -->
		
		<http auto-config="true">
			<intercept-url pattern="/login.do" access="permitAll"/>
			<intercept-url pattern="/admin/*" access="hasRole('ROLE_ADMIN')"/>
			<intercept-url pattern="/**" access="hasAnyRole('ROLE_USER', 'ROLE_ADMIN')"/>
 
			<form-login login-page="/login.do"
				login-processing-url="/login_check.do"
				default-target-url="/main.do"
				always-use-default-target="true"
				username-parameter="userId"
				password-parameter="userPass"
			 />
			 <logout invalidate-session="true" logout-success-url="/" logout-url="/log_out.do"/>
		</http>
		
		
		<beans:bean id="sqlSession" class="org.mybatis.spring.SqlSessionFactoryBean">
			<beans:property name="dataSource" ref="dataSource" />
			<beans:property name="configLocation" value="classpath:conf/mybatis-config.xml" />
			<!-- 	 
			<beans:property name="mapperLocations" value="classpath:/mapper/**/*_SQL.xml" />
			 -->
		</beans:bean>
	
		<beans:bean id="sqlSessionTemplate" class="org.mybatis.spring.SqlSessionTemplate">
			<beans:constructor-arg index="0" ref="sqlSession"/>
	 	</beans:bean> 
		
		
		
		<beans:bean id="dataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
			<beans:property name="driverClass" value="com.mysql.jdbc.Driver"/>
			<beans:property name="url" value="jdbc:mysql://172.16.100.102:3306/EunjiESM"/>
			<beans:property name="username" value="root"/>
			<beans:property name="password" value="conndb!@34"/>
		</beans:bean>
		
		<beans:bean id="userService" class="com.eunji.security.UserService"/>
		
		<beans:bean id="passwordEncoder" class="org.springframework.security.authentication.encoding.ShaPasswordEncoder" />
		<beans:bean id="saltSource" class="org.springframework.security.authentication.dao.ReflectionSaltSource">
			<beans:property name="userPropertyToUse" value="username" />
		</beans:bean>
		
		
		<authentication-manager alias="authenticationManager">	
			<authentication-provider user-service-ref="userService">
				<password-encoder ref="passwordEncoder">
					<!-- <salt-source ref="saltSource" /> -->
				</password-encoder>
			</authentication-provider>
			<!-- 
			 <authentication-provider>
				<user-service>
				<user name="admin" password="admin123!" authorities="ROLE_ADMIN"/>
					<user name="guest" password="guest" authorities="ROLE_USER"/>
				</user-service>
			</authentication-provider>
			 -->
		</authentication-manager>
		
		
		
</beans:beans>
